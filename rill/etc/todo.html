<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-11-04 Wed 14:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>New branch ensemble v2.0</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="adam" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">New branch ensemble v2.0</h1>
<div id="outline-container-org764361b" class="outline-2">
<h2 id="org764361b"><span class="done DONE">DONE</span> Create new score template</h2>
<div class="outline-text-2" id="text-org764361b">
<ul class="org-ul">
<li>update materials/instruments/definition.py</li>
<li>update tools/ScoreTemplate.py</li>
<li>test new Template by running ScoreTemplate.py locally</li>
</ul>
</div>
</div>

<div id="outline-container-org2e02e2a" class="outline-2">
<h2 id="org2e02e2a"><span class="done DONE">DONE</span> Import new segment maker from marana</h2>
<div class="outline-text-2" id="text-org2e02e2a">
<ul class="org-ul">
<li>replace rill/tools/SegmentMaker.py with marana/tools/SegmentMaker.py</li>
<li>compare differences, update functions:
<ul class="org-ul">
<li>_get<sub>music</sub><sub>voices</sub>(self)</li>
<li>_get<sub>staves</sub>(self)</li>
<li>_handle<sub>time</sub><sub>signatures</sub>(self)</li>
<li>_sort<sub>instruments</sub><sub>by</sub><sub>clef</sub>(self)</li>
<li>run(self)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org8d9401d" class="outline-2">
<h2 id="org8d9401d"><span class="done DONE">DONE</span> generate new structure for segments</h2>
<div class="outline-text-2" id="text-org8d9401d">
<ul class="org-ul">
<li>recursively delete all existing subdirectories and files in segments</li>
<li>import generator scripts from marana</li>
<li>run `generateSegments.sh` on the empty segments directory</li>
<li>rewrite DefGen.py to reflect structure of new score template</li>
<li>update makefile in builds to reflect new segments</li>
<li>delete all pdfs from builds/letter-portrait</li>
<li>update segments.ily file</li>
</ul>
</div>
</div>

<div id="outline-container-org8aba6ed" class="outline-2">
<h2 id="org8aba6ed"><span class="done DONE">DONE</span> Test build all segments and run make on the score</h2>
</div>


<div id="outline-container-org1d503e3" class="outline-2">
<h2 id="org1d503e3"><span class="todo IN_PROGRESS">IN-PROGRESS</span> Design generator script for creating definition.py files</h2>
<div class="outline-text-2" id="text-org1d503e3">
<ul class="org-ul">
<li>28-30. Oct 20: created new Dev branch and began working on
defGen<sub>v1.py</sub></li>
<li>define new classes that generate a "music code block" as output (use
factory method design pattern)</li>
<li>move mMakerGenerator into the MusicMaker module, so it can be
imported into the `segment_$X/definition.py`</li>
<li>test that output is building a coherant score
<ul class="org-ul">
<li>redefine basic structure to reflect that it is possible to import music data initializer objects from database in a systematic way</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgb9ca626" class="outline-2">
<h2 id="orgb9ca626"><span class="done CANCELED">CANCELED</span> Define workflow for "auditioning" and persisting music data init objects to db</h2>
<div class="outline-text-2" id="text-orgb9ca626">
<ul class="org-ul">
<li>currently, in order to see how a set of music data objects we're calling up a Segment</li>
<li>initial solution to persist music data objects on a per segment basis to some sort of a db failed -&gt; there was an issue with using mutable objects in a shelve db. I'm sure there is a way to set this up to work, possibly by using an OOdb. However, I'm going to try and keep things simple for now, see next todo for details</li>
</ul>
</div>
</div>
<div id="outline-container-org75f1dad" class="outline-2">
<h2 id="org75f1dad"><span class="done DONE">DONE</span> Simplify data storage for segment music data</h2>
<div class="outline-text-2" id="text-org75f1dad">
<ul class="org-ul">
<li>created two new classes SegmentPitchData and SegmentTaleaData</li>
<li>their members are simple (strings and lists of ints, respectively)</li>
<li>they can be pickled and stored in a shelve database, recalled on a per segment basis</li>
<li>this will let us script (at least some of) the variable assignment that needs to happen for each segment</li>
</ul>
</div>
</div>
<div id="outline-container-orgd87fce9" class="outline-2">
<h2 id="orgd87fce9"><span class="todo IN_PROGRESS">IN-PROGRESS</span> write generator script for "music data" files on a per segment basis</h2>
<div class="outline-text-2" id="text-orgd87fce9">
<ul class="org-ul">
<li>I'm going to exploit some of python's handy namespace rules and create a one module per segment to store the music initializer data</li>
<li>basically, there are two objects essential for this operation: "InstrumentMusicData" and "SegmentMusicData"</li>
<li>this means we can call the instance of "SegmentMusicData" that is in the segment scope in a way that supports scripting the definition files (basically the reason for this is to avoid hand-hacking the "definition.py" file</li>
<li>&#x2026;but there will ultimately be a little hand hacking&#x2026; basically, I'm going to initialize the pair of objects mentioned above with their default values and then override on a per segment basis</li>
</ul>
</div>
</div>
<div id="outline-container-org9fc91f7" class="outline-2">
<h2 id="org9fc91f7"><span class="done DONE">DONE</span> Define persistent data structure for material in segments</h2>
<div class="outline-text-2" id="text-org9fc91f7">
<ul class="org-ul">
<li>worked through a couple of iterations that tried to use a NamedTuple to manage the data used to initialize the music functions as they are passed into the SegmentMaker member functions before being typeset as notation. Problem is that it is seemingly not so easy to use user defined and complex types in a namedtuple</li>

<li>use of python's DataClass seems to facilitate working with (more) complex datatypes and custom classes

<ul class="org-ul">
<li>I'm trying to get around having to hand-hack the initialization of the MusicMaker objects: so I want to be able to generate the "definition.py" scripts on a per segment basis, and not have to tweak the output. So ideally, each "definition.py" would refer to an "init segment music" data class on a per instrument basis in each segment. This means that we could write a generator script for all instances of "definition.py" within the subdirectories of segments</li>
</ul></li>
</ul>

<div class="figure">
<p><img src="./segment_DataFlow.png" alt="segment_DataFlow.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org3c4bc75" class="outline-2">
<h2 id="org3c4bc75"><span class="done DONE">DONE</span> Write a member function in the MusicMaker class that tidies according to meter</h2>
<div class="outline-text-2" id="text-org3c4bc75">
<p>
"clean up rhythm" member function is now taking music as input and re-grouping the rhythms according to the time signatures as passed in by the "time signature pairs" variable
</p>
</div>
</div>

<div id="outline-container-org0a7e857" class="outline-2">
<h2 id="org0a7e857"><span class="done DONE">DONE</span> Define a way to persist objects that will be later used to construct MusicMaker objects</h2>
<div class="outline-text-2" id="text-org0a7e857">
<ul class="org-ul">
<li>Going to do a couple of experiments with python's shelve object</li>

<li>Test that you can access via Path</li>
</ul>
</div>
</div>

<div id="outline-container-org3cdfdbd" class="outline-2">
<h2 id="org3cdfdbd"><span class="todo TODO">TODO</span> Re-configure ScoreTemplate to reflect final instrumentation</h2>
</div>
<div id="outline-container-org4365102" class="outline-2">
<h2 id="org4365102"><span class="todo TODO">TODO</span> Find solution for missing instrument name markups</h2>
</div>
<div id="outline-container-orgf9f13bd" class="outline-2">
<h2 id="orgf9f13bd"><span class="todo TODO">TODO</span> Merge Dev branch into Ensemble</h2>
</div>

<div id="outline-container-org3f95efc" class="outline-2">
<h2 id="org3f95efc"><span class="todo TODO">TODO</span> Find way to tag score with build time and git branch</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: adam</p>
<p class="date">Created: 2020-11-04 Wed 14:15</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
